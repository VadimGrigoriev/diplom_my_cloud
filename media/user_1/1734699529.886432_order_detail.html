    <script type="text/javascript">
            // Обработчик на кнопку "Редактировать" терминал
            $(document).on('click', '.order-button-edit', function () {
                let terminalId = $(this).data('id');
                console.log(terminalId);

                $.ajax({
                    url: `/devices/get_terminal_data/${terminalId}/`,
                    type: 'GET',
                    success: function (data) {
                        console.log(data);
                        let rzaCode = data.data.rza_code;
                        let rzaCodeNumber = parseInt(rzaCode, 10);
                        let terminalNumberInput = $('#terminalNumber');

                        terminalNumberInput.val(data.data.terminal_number);
                        if (!terminalNumberInput.attr('data-rza-code')) {
                            terminalNumberInput.attr('data-rza-code', data.data.rza_code);
                        }

                        let parametersContainer = $('#parameters-container');
                        parametersContainer.empty();

                        // Достаем текущие значения параметров
                        let selectedValues = data.data.terminal_param_values;

                        function createParameterGroup(param, level = 0) {
                            let groupDiv = $('<div>').addClass(`parameter-group level-${level} mb-3`).attr('data-param-id', param.id);
                            let headerDiv = $('<div>').addClass('parameter-header d-flex align-items-center cursor-pointer bg-light p-2 rounded');

                            let toggleIcon = $('<i>').addClass('fas fa-chevron-down me-2');
                            let headerText = $('<span>').addClass('fw-bold').text(param.name);

                            headerDiv.append(toggleIcon).append(headerText);
                            groupDiv.append(headerDiv);

                            let contentDiv = $('<div>').addClass('parameter-content mt-2 ms-4');
                            if (level > 0) {
                                contentDiv.hide();
                                toggleIcon.removeClass('fa-chevron-down').addClass('fa-chevron-right');
                            }

                            if (param.children.length > 0) {
                                param.children.forEach(child => {
                                    contentDiv.append(createParameterGroup(child, level + 1));
                                });
                            } else if (param.values.length > 0) {
                                let checkboxGroup = $('<div>').addClass('d-flex flex-wrap gap-2');
                                param.values.forEach(value => {
                                    let label = $('<label>').addClass('btn btn-outline-secondary');
                                    let checkbox = $('<input>').attr({
                                        type: 'checkbox',
                                        name: `param-${param.id}`,
                                        value: value,
                                        id: `param-${param.id}-${value}`,
                                        'data-param-id': param.id,
                                        'data-level': level
                                    }).addClass('btn-check parameter-checkbox');

                                    // Отмечаем чекбокс, если значение совпадает с уже выбранным
                                    if (selectedValues[param.id] === value) {
                                        checkbox.prop('checked', true).attr('data-selected-before', true);
                                        label.addClass('active');
                                    }

                                    label.append(checkbox).append(value);
                                    checkboxGroup.append(label);
                                });
                                contentDiv.append(checkboxGroup);
                            }

                            groupDiv.append(contentDiv);

                            headerDiv.on('click', function(e) {
                                e.stopPropagation();
                                toggleIcon.toggleClass('fa-chevron-right fa-chevron-down');
                                contentDiv.slideToggle();
                            });

                            return groupDiv;
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('Ошибка при загрузке данных терминала:', error);
                        showToast('Ошибка при загрузке данных терминала: ' + error, false);
                    }
                });

                // Обработчик для кнопки "Сохранить" в модальном окне редактирования терминала
                $('#saveTerminalButton').off('click').on('click', function() {
                    saveTerminal(terminalId);
                });
            });

            // Функция для сохранения параметров терминала
            function saveTerminal(terminalId) {
                console.log(terminalId);
                let terminalNumberInput = $('#terminalNumber');
                let terminalNumber = terminalNumberInput.val();
                let rzaCodeNumber = terminalNumberInput.attr('data-rza-code');

                // Проверка валидации номера терминала
                let isValid = terminalNumber.startsWith(rzaCodeNumber.toString()) && terminalNumber.length === 7 && /^\d{7}$/.test(terminalNumber);

                if (!isValid) {
                    // Если номер терминала не прошел валидацию, показываем Popover с ошибкой
                    showValidationPopover('#saveTerminalButton', `Номер терминала должен иметь следующий формат: ${rzaCodeNumber}XXXX, где XXXX - 4 цифры.`);
                    return;  // Отменяем сохранение
                }

                let formData = {
                    terminal_number: terminalNumber,
                    parameters: {}
                };

                $('.parameter-checkbox:checked').each(function() {
                    let $this = $(this);
                    let paramId = $this.data('param-id');
                    formData.parameters[paramId] = $this.val();
                });

                console.log('Данные для отправки:', formData);
                $.ajax({
                    url: `/devices/save_terminal_data/${terminalId}/`,
                    type: 'POST',
                    headers: {
                        'X-CSRFToken': csrftoken
                    },
                    data: JSON.stringify(formData),
                    contentType: 'application/json',
                    success: function(response) {
                        if (response.status === 'success') {
                            console.log('Данные успешно сохранены');
                            $('#editTerminalModal').modal('hide');  // Закрываем модальное окно
                            table.ajax.reload(null, false);
                            showToast(`Терминал ${terminalNumber} успешно сохранен`, true);
                        } else {
                            console.error('Ошибка:', response.message);
                            showValidationPopover('#saveTerminalButton', response.message || 'Произошла ошибка при сохранении терминала');
                            {#showToast(response.message || 'Произошла ошибка при сохранении терминала', false);#}
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Ошибка при сохранении данных терминала:', error);
                        console.log(xhr.responseText);
                        showToast(xhr.responseText || 'Произошла ошибка при сохранении терминала', false);
                    }
                });
            };
    </script>